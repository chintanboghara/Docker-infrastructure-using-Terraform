# Build infrastructure

- Follow the steps below if starting fresh:

  ```bash
  mkdir terraform-docker-container
  cd terraform-docker-container
  touch main.tf
  ```

## Configuration

### `main.tf`
```hcl
terraform {
  required_providers {
    docker = {
      source  = "kreuzwerker/docker"
      version = "~> 3.0.1"
    }
  }
}

provider "docker" {}

resource "docker_image" "nginx" {
  name         = "nginx:latest"
  keep_locally = false
}

resource "docker_container" "nginx" {
  image = docker_image.nginx.image_id
  name  = "nginx"
  ports {
    internal = 80
    external = 8000
  }
}
```

### 1. Initialize Terraform
Download the Docker provider:
```bash
terraform init
```

### 2. Format and Validate Configuration
- Format:
  ```bash
  terraform fmt
  ```
- Validate:
  ```bash
  terraform validate
  ```

### 3. Deploy Infrastructure
```bash
terraform apply
```
- Confirm with `yes` when prompted.
- Access Nginx at [http://localhost:8000](http://localhost:8000).

## Key Concepts

### Terraform Block
- Specifies required providers and versions.
- Example:
  ```hcl
  terraform {
    required_providers {
      docker = {
        source  = "kreuzwerker/docker"
        version = "~> 3.0.1"
      }
    }
  }
  ```

### Provider Block
- Configures the Docker provider:
  ```hcl
  provider "docker" {}
  ```

### Resources
- **`docker_image`**: Pulls the Nginx image.
- **`docker_container`**: Runs the container with port mapping.

## Inspecting State
- View state details:
  ```bash
  terraform show
  ```
- List resources in state:
  ```bash
  terraform state list
  ```

## Cleanup
Destroy the container and image:
```bash
terraform destroy
```

> **Note**: The Terraform state (`terraform.tfstate`) tracks resource metadata. Store it securely in production. 
